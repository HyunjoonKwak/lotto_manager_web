{% extends "mobile/base.html" %}

{% block title %}ëª¨ë°”ì¼ ì „ëµë¶„ì„{% endblock %}

{% block content %}
<!-- ëª¨ë°”ì¼ í—¤ë” -->
<div class="mobile-header">
  <div class="title">
    <h1>ğŸ“Š ì „ëµë¶„ì„</h1>
    <div class="subtitle">AI ê¸°ë°˜ ë²ˆí˜¸ ì¶”ì²œ</div>
  </div>
</div>

<!-- ì¶”ì²œ ë²ˆí˜¸ ì¹´ë“œ -->
{% if recommendations %}
<div class="mobile-card">
  <div class="card-header">
    <h2>ğŸ¯ AI ì¶”ì²œ ë²ˆí˜¸</h2>
    <button class="refresh-btn" onclick="refreshRecommendations()">ğŸ”„</button>
  </div>

  {% for rec in recommendations[:3] %}
  <div class="recommendation-item">
    <div class="rec-header">
      <span class="rec-type">AI ì¶”ì²œ #{{ loop.index }}</span>
      <span class="rec-score">ì¶”ì²œ</span>
    </div>

    <div class="numbers">
      {% for num in rec %}
      <span class="number">{{ num }}</span>
      {% endfor %}
    </div>

    <div class="rec-actions">
      <button class="btn-small btn-primary" onclick="addToPurchase('{{ rec|join(',') }}')">
        êµ¬ë§¤ ì¶”ê°€
      </button>
    </div>
  </div>
  {% endfor %}
</div>
{% endif %}

<!-- êµ¬ë§¤ ëª©ë¡ -->
{% if purchases %}
<div class="mobile-card">
  <div class="card-header">
    <h2>ğŸ›’ ìµœê·¼ êµ¬ë§¤</h2>
    <span class="count">{{ purchases|length }}ê±´</span>
  </div>

  <div class="purchase-list">
    {% for purchase in purchases[:5] %}
    <div class="purchase-item">
      <div class="purchase-header">
        <span class="purchase-date">{{ purchase.purchase_date.strftime('%m/%d %H:%M') }}</span>
        <span class="purchase-round">{{ purchase.round }}íšŒ</span>
      </div>

      <div class="numbers">
        {% for num in purchase.numbers.split(',') %}
        <span class="number small">{{ num }}</span>
        {% endfor %}
      </div>

      {% if purchase.winning_amount %}
      <div class="winning-result">
        <span class="winning-amount">{{ "{:,}".format(purchase.winning_amount) }}ì› ë‹¹ì²¨!</span>
      </div>
      {% endif %}
    </div>
    {% endfor %}

    {% if purchases|length > 5 %}
    <div class="more-items">
      <a href="{{ url_for('main.purchase_history') }}">ì „ì²´ êµ¬ë§¤ë‚´ì—­ ë³´ê¸° â†’</a>
    </div>
    {% endif %}
  </div>
</div>
{% endif %}

<!-- í†µê³„ ì¹´ë“œ -->
<div class="mobile-card">
  <div class="card-header">
    <h2>ğŸ“ˆ ë‚˜ì˜ í†µê³„</h2>
  </div>

  <div class="stats-grid">
    <div class="stat-item">
      <div class="stat-number">{{ total_purchases or 0 }}</div>
      <div class="stat-label">ì´ êµ¬ë§¤</div>
    </div>
    <div class="stat-item">
      <div class="stat-number">{{ total_spent or 0 | int }}ì›</div>
      <div class="stat-label">ì´ êµ¬ë§¤ê¸ˆì•¡</div>
    </div>
    <div class="stat-item">
      <div class="stat-number">{{ total_winnings or 0 | int }}ì›</div>
      <div class="stat-label">ì´ ë‹¹ì²¨ê¸ˆì•¡</div>
    </div>
    <div class="stat-item">
      <div class="stat-number">{{ win_rate or 0 }}%</div>
      <div class="stat-label">ë‹¹ì²¨ë¥ </div>
    </div>
  </div>
</div>

<!-- ìˆ˜ë™ ë²ˆí˜¸ ì…ë ¥ (ê°œì„ ëœ ë²„ì „) -->
<div class="mobile-card">
  <div class="card-header">
    <h2>âœï¸ ìˆ˜ë™ ë²ˆí˜¸ ì…ë ¥</h2>
  </div>

  <!-- ì…ë ¥ ë°©ì‹ ì„ íƒ -->
  <div class="input-tabs">
    <button class="tab-button" data-method="grid" onclick="switchMobileMethod('grid')">
      ğŸ¯ ì§ì ‘ ì„ íƒ
    </button>
    <button class="tab-button active" data-method="text" onclick="switchMobileMethod('text')">
      âœï¸ í…ìŠ¤íŠ¸ ì…ë ¥
    </button>
    <button class="tab-button" data-method="random" onclick="switchMobileMethod('random')">
      ğŸ² ëœë¤
    </button>
  </div>

  <!-- íšŒì°¨ ì…ë ¥ -->
  <div class="round-input-section">
    <label>ëŒ€ìƒ íšŒì°¨ (ì„ íƒì‚¬í•­)</label>
    <input type="number" id="mobileRound" placeholder="ìë™ ì„¤ì •" class="mobile-input">
  </div>

  <!-- ê·¸ë¦¬ë“œ ì„ íƒ ë°©ì‹ -->
  <div class="input-method-mobile grid-method">
    <div class="mobile-number-grid">
      {% for i in range(1, 46) %}
      <button class="mobile-number-btn" data-number="{{ i }}" onclick="toggleMobileNumber({{ i }})">{{ i }}</button>
      {% endfor %}
    </div>

    <div class="mobile-selected">
      <div class="selected-info">
        <span>ì„ íƒëœ ë²ˆí˜¸ (<span id="mobileSelectedCount">0</span>/6)</span>
        <button class="clear-mobile-btn" onclick="clearMobileSelection()">ì´ˆê¸°í™”</button>
      </div>
      <div class="mobile-selected-display" id="mobileSelectedDisplay">
        ë²ˆí˜¸ë¥¼ ì„ íƒí•˜ì„¸ìš”
      </div>
    </div>
  </div>

  <!-- í…ìŠ¤íŠ¸ ì…ë ¥ ë°©ì‹ -->
  <div class="input-method-mobile text-method active">
    <div class="text-input-section">
      <label>ë²ˆí˜¸ ì…ë ¥ (1-45 ì‚¬ì´ì˜ 6ê°œ ìˆ«ì)</label>
      <input type="text" id="mobileNumbers" placeholder="ì˜ˆ: 1, 7, 12, 23, 32, 40" class="mobile-input">
      <button class="mobile-btn secondary" onclick="parseMobileNumbers()">ë²ˆí˜¸ ì ìš©</button>
    </div>

    <!-- í…ìŠ¤íŠ¸ ì…ë ¥ì—ì„œë„ ì„ íƒëœ ë²ˆí˜¸ í‘œì‹œ -->
    <div class="mobile-selected">
      <div class="selected-info">
        <span>ì„ íƒëœ ë²ˆí˜¸ (<span id="mobileSelectedCountText">0</span>/6)</span>
        <button class="clear-mobile-btn" onclick="clearMobileSelection()">ì´ˆê¸°í™”</button>
      </div>
      <div class="mobile-selected-display" id="mobileSelectedDisplayText">
        ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ê³  ì ìš© ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”
      </div>
    </div>
  </div>

  <!-- ëœë¤ ìƒì„± ë°©ì‹ -->
  <div class="input-method-mobile random-method">
    <div class="random-buttons">
      <button class="mobile-btn secondary" onclick="generateMobileRandom()">ğŸ² ì™„ì „ ëœë¤</button>
      <button class="mobile-btn secondary" onclick="generateMobileRandom('hot')">ğŸ”¥ ë¹ˆì¶œë²ˆí˜¸ ê¸°ë°˜</button>
      <button class="mobile-btn secondary" onclick="generateMobileRandom('cold')">â„ï¸ ë¯¸ì¶œë²ˆí˜¸ ê¸°ë°˜</button>
    </div>
  </div>

  <!-- ì¶”ê°€ ë²„íŠ¼ -->
  <div class="add-section">
    <button class="mobile-btn primary large" id="mobileAddBtn" onclick="addMobileNumbers()" disabled>
      â• ë²ˆí˜¸ ì¶”ê°€í•˜ê¸°
    </button>
  </div>
</div>

<!-- ë¹ ë¥¸ ì•¡ì…˜ -->
<div class="mobile-card">
  <div class="card-header">
    <h2>ğŸ² ë¹ ë¥¸ ì•¡ì…˜</h2>
  </div>

  <div class="action-buttons">
    <button class="btn-action" onclick="getNewRecommendation()">
      <span class="action-icon">ğŸ”®</span>
      <span class="action-text">ìƒˆ ì¶”ì²œë°›ê¸°</span>
    </button>
    <button class="btn-action" onclick="quickPurchase()">
      <span class="action-icon">âš¡</span>
      <span class="action-text">ë¹ ë¥¸ êµ¬ë§¤</span>
    </button>
    <a href="{{ url_for('main.crawling_page') }}" class="btn-action">
      <span class="action-icon">ğŸ”„</span>
      <span class="action-text">ë°ì´í„° ì—…ë°ì´íŠ¸</span>
    </a>
  </div>
</div>

<!-- ë°ìŠ¤í¬í†± ë²„ì „ ë§í¬ -->
<div class="desktop-link">
  <a href="{{ url_for('main.strategy') }}?desktop=1" class="link-desktop">
    ğŸ–¥ï¸ ë°ìŠ¤í¬í†± ë²„ì „ìœ¼ë¡œ ë³´ê¸°
  </a>
</div>
{% endblock %}

{% block scripts %}
<style>
.refresh-btn {
  background: rgba(255, 255, 255, 0.2);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  padding: 0.3rem 0.6rem;
  border-radius: 0.5rem;
  font-size: 0.9rem;
  cursor: pointer;
}

.recommendation-item {
  padding: 1rem;
  border-bottom: 1px solid #e2e8f0;
  background: #f8fafc;
  margin-bottom: 0.5rem;
  border-radius: 0.8rem;
}

.recommendation-item:last-child {
  border-bottom: none;
  margin-bottom: 0;
}

.rec-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.5rem;
}

.rec-type {
  background: linear-gradient(135deg, #4299e1, #3182ce);
  color: white;
  padding: 0.2rem 0.6rem;
  border-radius: 1rem;
  font-size: 0.75rem;
  font-weight: 600;
}

.rec-score {
  font-size: 0.8rem;
  color: #718096;
  font-weight: 500;
}

.rec-reason {
  font-size: 0.8rem;
  color: #4a5568;
  margin: 0.5rem 0;
  line-height: 1.4;
}

.rec-actions {
  margin-top: 0.5rem;
}

.btn-small {
  padding: 0.4rem 0.8rem;
  font-size: 0.8rem;
  border-radius: 0.5rem;
  border: none;
  font-weight: 600;
  cursor: pointer;
}

.purchase-list {
  padding: 1rem;
}

.purchase-item {
  padding: 0.8rem;
  background: #f8fafc;
  margin-bottom: 0.5rem;
  border-radius: 0.8rem;
  border-left: 3px solid #4299e1;
}

.purchase-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.5rem;
}

.purchase-date {
  font-size: 0.85rem;
  color: #718096;
}

.purchase-round {
  font-size: 0.8rem;
  background: #e2e8f0;
  padding: 0.2rem 0.5rem;
  border-radius: 0.3rem;
  color: #4a5568;
  font-weight: 500;
}

.number.small {
  width: 2rem;
  height: 2rem;
  font-size: 0.75rem;
}

.winning-result {
  margin-top: 0.5rem;
}

.winning-amount {
  color: #e53e3e;
  font-weight: 700;
  font-size: 0.9rem;
}

.more-items {
  text-align: center;
  padding: 0.8rem;
}

.more-items a {
  color: #4299e1;
  text-decoration: none;
  font-weight: 500;
  font-size: 0.9rem;
}

.stats-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 0.5rem;
  padding: 1rem;
}

.stat-item {
  text-align: center;
  padding: 1rem;
  background: linear-gradient(135deg, #f7fafc, #edf2f7);
  border-radius: 0.8rem;
}

.stat-number {
  font-size: 1.2rem;
  font-weight: 700;
  color: #2d3748;
  margin-bottom: 0.3rem;
}

.stat-label {
  font-size: 0.8rem;
  color: #718096;
}

.action-buttons {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  padding: 1rem;
}

.btn-action {
  display: flex;
  align-items: center;
  gap: 0.8rem;
  padding: 1rem;
  background: linear-gradient(135deg, #f7fafc, #edf2f7);
  border: 1px solid #e2e8f0;
  border-radius: 0.8rem;
  text-decoration: none;
  color: #4a5568;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-action:active {
  transform: scale(0.98);
  background: linear-gradient(135deg, #edf2f7, #e2e8f0);
}

.action-icon {
  font-size: 1.3rem;
}

.action-text {
  font-size: 0.9rem;
}

/* ëª¨ë°”ì¼ ìˆ˜ë™ ì…ë ¥ ê°œì„  ìŠ¤íƒ€ì¼ */
.input-tabs {
  display: flex;
  background: #f1f5f9;
  border-radius: 0.8rem;
  padding: 0.3rem;
  margin-bottom: 1rem;
}

.tab-button {
  flex: 1;
  padding: 0.6rem 0.4rem;
  border: none;
  background: transparent;
  border-radius: 0.5rem;
  font-size: 0.8rem;
  font-weight: 500;
  color: #64748b;
  cursor: pointer;
  transition: all 0.2s;
  text-align: center;
}

.tab-button.active {
  background: white;
  color: #1e40af;
  font-weight: 600;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.input-method-mobile {
  display: none;
  padding: 1rem;
}

.input-method-mobile.active {
  display: block;
}

.round-input-section {
  margin-bottom: 1.5rem;
}

.round-input-section label {
  display: block;
  font-size: 0.85rem;
  color: #4a5568;
  margin-bottom: 0.5rem;
  font-weight: 500;
}

.mobile-input {
  width: 100%;
  padding: 0.8rem;
  border: 2px solid #e2e8f0;
  border-radius: 0.6rem;
  font-size: 1rem;
  background: white;
  transition: border-color 0.2s;
}

.mobile-input:focus {
  outline: none;
  border-color: #4299e1;
}

.mobile-number-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 0.6rem;
  margin-bottom: 1.5rem;
}

.mobile-number-btn {
  aspect-ratio: 1;
  border: 2px solid #e2e8f0;
  background: white;
  border-radius: 0.6rem;
  font-size: 0.9rem;
  font-weight: 600;
  color: #4a5568;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 44px;
}

.mobile-number-btn:active {
  transform: scale(0.95);
}

.mobile-number-btn.selected {
  background: linear-gradient(135deg, #4299e1, #3182ce);
  border-color: #3182ce;
  color: white;
  transform: scale(1.05);
}

.mobile-selected {
  background: #f8fafc;
  border-radius: 0.8rem;
  padding: 1rem;
  margin-bottom: 1rem;
}

.selected-info {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.8rem;
  font-size: 0.85rem;
  font-weight: 500;
  color: #4a5568;
}

.clear-mobile-btn {
  background: #ef4444;
  color: white;
  border: none;
  padding: 0.4rem 0.8rem;
  border-radius: 0.5rem;
  font-size: 0.75rem;
  font-weight: 600;
  cursor: pointer;
}

.mobile-selected-display {
  min-height: 3rem;
  background: white;
  border: 2px dashed #cbd5e0;
  border-radius: 0.6rem;
  padding: 0.8rem;
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  align-items: center;
  justify-content: center;
  font-size: 0.85rem;
  color: #718096;
}

.mobile-selected-display .number {
  background: linear-gradient(135deg, #4299e1, #3182ce);
  color: white;
  padding: 0.3rem 0.6rem;
  border-radius: 0.4rem;
  font-weight: 600;
  font-size: 0.8rem;
}

.text-input-section {
  display: flex;
  flex-direction: column;
  gap: 0.8rem;
}

.text-input-section label {
  font-size: 0.85rem;
  color: #4a5568;
  font-weight: 500;
}

.mobile-btn {
  padding: 0.8rem 1.2rem;
  border: none;
  border-radius: 0.6rem;
  font-size: 0.9rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  text-align: center;
}

.mobile-btn.primary {
  background: linear-gradient(135deg, #4299e1, #3182ce);
  color: white;
}

.mobile-btn.primary:active {
  transform: scale(0.98);
  background: linear-gradient(135deg, #3182ce, #2c5aa0);
}

.mobile-btn.secondary {
  background: #f1f5f9;
  color: #4a5568;
  border: 1px solid #e2e8f0;
}

.mobile-btn.secondary:active {
  background: #e2e8f0;
}

.mobile-btn.large {
  font-size: 1rem;
  padding: 1rem 1.5rem;
}

.mobile-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none !important;
}

.random-buttons {
  display: flex;
  flex-direction: column;
  gap: 0.8rem;
}

.add-section {
  margin-top: 1.5rem;
  text-align: center;
}
</style>

<script>
// ì¶”ì²œ ìƒˆë¡œê³ ì¹¨
async function refreshRecommendations() {
  const response = await fetch('/api/refresh-recommendations', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' }
  });

  if (response.ok) {
    window.location.reload();
  } else {
    alert('ì¶”ì²œ ìƒˆë¡œê³ ì¹¨ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
  }
}

// êµ¬ë§¤ ì¶”ê°€
function addToPurchase(numbers) {
  // ê°„ë‹¨í•œ í™•ì¸ í›„ êµ¬ë§¤ í˜ì´ì§€ë¡œ ì´ë™
  const confirmed = confirm(`ì¶”ì²œ ë²ˆí˜¸ ${numbers}ë¥¼ êµ¬ë§¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`);
  if (confirmed) {
    // êµ¬ë§¤ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ (ë²ˆí˜¸ í¬í•¨)
    window.location.href = `/purchases?auto_numbers=${encodeURIComponent(numbers)}`;
  }
}

// ìƒˆ ì¶”ì²œë°›ê¸°
async function getNewRecommendation() {
  const response = await fetch('/api/recommend');
  if (response.ok) {
    window.location.reload();
  } else {
    alert('ìƒˆ ì¶”ì²œì„ ë°›ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
  }
}

// ë¹ ë¥¸ êµ¬ë§¤
function quickPurchase() {
  window.location.href = '{{ url_for("main.purchase_history") }}';
}

// ëª¨ë°”ì¼ ìˆ˜ë™ ì…ë ¥ ê¸°ëŠ¥
let mobileSelectedNumbers = [];

// ì…ë ¥ ë°©ì‹ ë³€ê²½
function switchMobileMethod(method, keepSelection = false) {
  // íƒ­ ë²„íŠ¼ í™œì„±í™”
  document.querySelectorAll('.tab-button').forEach(btn => {
    btn.classList.remove('active');
    if (btn.dataset.method === method) {
      btn.classList.add('active');
    }
  });

  // ì…ë ¥ ë°©ì‹ í™”ë©´ ë³€ê²½
  document.querySelectorAll('.input-method-mobile').forEach(section => {
    section.classList.remove('active');
  });
  document.querySelector(`.${method}-method`).classList.add('active');

  // ì„ íƒ ìœ ì§€ ì˜µì…˜ì´ ì—†ìœ¼ë©´ ì´ˆê¸°í™”
  if (!keepSelection) {
    clearMobileSelection();
  }
}

// ë²ˆí˜¸ ì„ íƒ/í•´ì œ
function toggleMobileNumber(num) {
  const index = mobileSelectedNumbers.indexOf(num);

  if (index > -1) {
    // ì´ë¯¸ ì„ íƒëœ ë²ˆí˜¸ë©´ ì œê±°
    mobileSelectedNumbers.splice(index, 1);
    document.querySelector(`[data-number="${num}"]`).classList.remove('selected');
  } else {
    // 6ê°œ ì´ˆê³¼ ì„ íƒ ë°©ì§€
    if (mobileSelectedNumbers.length >= 6) {
      alert('ìµœëŒ€ 6ê°œ ë²ˆí˜¸ê¹Œì§€ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
      return;
    }
    // ìƒˆ ë²ˆí˜¸ ì¶”ê°€
    mobileSelectedNumbers.push(num);
    document.querySelector(`[data-number="${num}"]`).classList.add('selected');
  }

  updateMobileDisplay();
}

// ì„ íƒëœ ë²ˆí˜¸ í™”ë©´ ì—…ë°ì´íŠ¸
function updateMobileDisplay() {
  const countElement = document.getElementById('mobileSelectedCount');
  const displayElement = document.getElementById('mobileSelectedDisplay');
  const countElementText = document.getElementById('mobileSelectedCountText');
  const displayElementText = document.getElementById('mobileSelectedDisplayText');
  const addBtn = document.getElementById('mobileAddBtn');

  // ì„ íƒëœ ë²ˆí˜¸ ê°œìˆ˜ ì—…ë°ì´íŠ¸
  const count = mobileSelectedNumbers.length;
  console.log('updateMobileDisplay í˜¸ì¶œë¨, ì„ íƒëœ ë²ˆí˜¸:', mobileSelectedNumbers);

  if (countElement) countElement.textContent = count;
  if (countElementText) countElementText.textContent = count;

  // ì„ íƒëœ ë²ˆí˜¸ í‘œì‹œ
  let displayHTML;
  if (count === 0) {
    displayHTML = 'ë²ˆí˜¸ë¥¼ ì„ íƒí•˜ì„¸ìš”';
    if (displayElementText) displayElementText.innerHTML = 'ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ê³  ì ìš© ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”';
  } else {
    const sortedNumbers = [...mobileSelectedNumbers].sort((a, b) => a - b);
    displayHTML = sortedNumbers.map(num =>
      `<span class="number">${num}</span>`
    ).join('');
    if (displayElementText) displayElementText.innerHTML = displayHTML;
  }
  if (displayElement) displayElement.innerHTML = displayHTML;

  // ì¶”ê°€ ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”
  if (addBtn) {
    addBtn.disabled = count !== 6;
    console.log('ì¶”ê°€ ë²„íŠ¼ ìƒíƒœ:', addBtn.disabled ? 'ë¹„í™œì„±í™”' : 'í™œì„±í™”');
  }
}

// ì„ íƒ ì´ˆê¸°í™”
function clearMobileSelection() {
  mobileSelectedNumbers = [];
  document.querySelectorAll('.mobile-number-btn').forEach(btn => {
    btn.classList.remove('selected');
  });
  const textInput = document.getElementById('mobileNumbers');
  if (textInput) {
    textInput.value = '';
  }
  updateMobileDisplay();
}

// í…ìŠ¤íŠ¸ ì…ë ¥ ë²ˆí˜¸ ì²˜ë¦¬
function parseMobileNumbers() {
  console.log('parseMobileNumbers í•¨ìˆ˜ í˜¸ì¶œë¨');

  const input = document.getElementById('mobileNumbers').value.trim();
  console.log('ì…ë ¥ëœ í…ìŠ¤íŠ¸:', input);

  if (!input) {
    alert('ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }

  // ìˆ«ì ì¶”ì¶œ (ì‰¼í‘œ, ê³µë°±, í•˜ì´í”ˆ ë“±ìœ¼ë¡œ êµ¬ë¶„)
  const numbers = input.match(/\d+/g);
  console.log('ì¶”ì¶œëœ ìˆ«ìë“¤:', numbers);

  if (!numbers || numbers.length !== 6) {
    alert('ì •í™•íˆ 6ê°œì˜ ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }

  // ë²ˆí˜¸ ìœ íš¨ì„± ê²€ì‚¬
  const validNumbers = [];
  for (let numStr of numbers) {
    const num = parseInt(numStr);
    if (num < 1 || num > 45) {
      alert(`${num}ì€ ìœ íš¨í•˜ì§€ ì•Šì€ ë²ˆí˜¸ì…ë‹ˆë‹¤. (1-45 ì‚¬ì´ì˜ ë²ˆí˜¸ë§Œ ê°€ëŠ¥)`);
      return;
    }
    if (validNumbers.includes(num)) {
      alert(`${num}ì€ ì¤‘ë³µëœ ë²ˆí˜¸ì…ë‹ˆë‹¤.`);
      return;
    }
    validNumbers.push(num);
  }

  console.log('ìœ íš¨í•œ ë²ˆí˜¸ë“¤:', validNumbers);

  // ë°°ì—´ì— ë²ˆí˜¸ ì„¤ì •
  mobileSelectedNumbers = [...validNumbers];

  console.log('mobileSelectedNumbers ì„¤ì • ì™„ë£Œ:', mobileSelectedNumbers);
  console.log('í˜„ì¬ í™œì„± íƒ­:', document.querySelector('.tab-button.active')?.dataset.method);

  // í™”ë©´ ì—…ë°ì´íŠ¸
  updateMobileDisplay();

  // ì„±ê³µ ë©”ì‹œì§€
  const sortedNumbers = validNumbers.sort((a,b) => a-b);
  alert(`ë²ˆí˜¸ê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!\nì„ íƒëœ ë²ˆí˜¸: ${sortedNumbers.join(', ')}\n\nì´ì œ í•˜ë‹¨ì˜ "ë²ˆí˜¸ ì¶”ê°€í•˜ê¸°" ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.`);
}

// ëœë¤ ë²ˆí˜¸ ìƒì„±
function generateMobileRandom(type = 'normal') {
  clearMobileSelection();

  let numbers = [];

  if (type === 'hot') {
    // ë¹ˆì¶œë²ˆí˜¸ ê¸°ë°˜ (ì‹¤ì œë¡œëŠ” ê°€ì¤‘ì¹˜ ì ìš©í•´ì•¼ í•˜ì§€ë§Œ ì—¬ê¸°ì„œëŠ” ë‹¨ìˆœí™”)
    const hotNumbers = [1, 7, 17, 23, 27, 31, 34, 40, 43, 44]; // ì˜ˆì‹œ ë¹ˆì¶œë²ˆí˜¸
    while (numbers.length < 6) {
      const num = hotNumbers[Math.floor(Math.random() * hotNumbers.length)];
      if (!numbers.includes(num)) {
        numbers.push(num);
      }
    }
  } else if (type === 'cold') {
    // ë¯¸ì¶œë²ˆí˜¸ ê¸°ë°˜
    const coldNumbers = [2, 8, 13, 16, 22, 28, 33, 37, 39, 42]; // ì˜ˆì‹œ ë¯¸ì¶œë²ˆí˜¸
    while (numbers.length < 6) {
      const num = coldNumbers[Math.floor(Math.random() * coldNumbers.length)];
      if (!numbers.includes(num)) {
        numbers.push(num);
      }
    }
  } else {
    // ì™„ì „ ëœë¤
    while (numbers.length < 6) {
      const num = Math.floor(Math.random() * 45) + 1;
      if (!numbers.includes(num)) {
        numbers.push(num);
      }
    }
  }

  // ì„ íƒëœ ë²ˆí˜¸ë“¤ì„ ë°°ì—´ì— ì¶”ê°€
  numbers.forEach(num => {
    mobileSelectedNumbers.push(num);
    document.querySelector(`[data-number="${num}"]`).classList.add('selected');
  });

  // ê·¸ë¦¬ë“œ ë°©ì‹ìœ¼ë¡œ ì „í™˜í•˜ì—¬ ì„ íƒ í‘œì‹œ (ì„ íƒ ìƒíƒœ ìœ ì§€)
  switchMobileMethod('grid', true);
  updateMobileDisplay();
}

// ë²ˆí˜¸ ì¶”ê°€í•˜ê¸°
function addMobileNumbers() {
  if (mobileSelectedNumbers.length !== 6) {
    alert('6ê°œì˜ ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.');
    return;
  }

  const round = document.getElementById('mobileRound').value;
  const numbers = [...mobileSelectedNumbers].sort((a, b) => a - b);

  // êµ¬ë§¤ í˜ì´ì§€ë¡œ ì´ë™ (ë²ˆí˜¸ í¬í•¨)
  const params = new URLSearchParams();
  params.append('auto_numbers', numbers.join(','));
  if (round) {
    params.append('round', round);
  }

  window.location.href = `/purchases?${params.toString()}`;
}

// ì¦‰ì‹œ ì‹¤í–‰ìœ¼ë¡œ ê¸°ë³¸ ì²´í¬
console.log('ëª¨ë°”ì¼ ì „ëµë¶„ì„ í˜ì´ì§€ JavaScript ë¡œë“œë¨');
console.log('í˜„ì¬ URL:', window.location.href);
console.log('User Agent:', navigator.userAgent);

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
document.addEventListener('DOMContentLoaded', function() {
  console.log('DOMContentLoaded ì´ë²¤íŠ¸ ë°œìƒ');
  console.log('í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ, ì´ˆê¸°í™” ì‹œì‘');

  // DOM ìš”ì†Œ ì¡´ì¬ í™•ì¸
  const addBtn = document.getElementById('mobileAddBtn');
  const textInput = document.getElementById('mobileNumbers');
  const countText = document.getElementById('mobileSelectedCountText');

  console.log('DOM ìš”ì†Œ í™•ì¸:');
  console.log('- mobileAddBtn:', addBtn ? 'ì¡´ì¬' : 'ì—†ìŒ');
  console.log('- mobileNumbers:', textInput ? 'ì¡´ì¬' : 'ì—†ìŒ');
  console.log('- mobileSelectedCountText:', countText ? 'ì¡´ì¬' : 'ì—†ìŒ');

  // í…ìŠ¤íŠ¸ ì…ë ¥ íƒ­ì„ ê¸°ë³¸ìœ¼ë¡œ ì„¤ì •
  switchMobileMethod('text');

  // ì´ˆê¸° ìƒíƒœ ì—…ë°ì´íŠ¸
  updateMobileDisplay();

  console.log('ì´ˆê¸°í™” ì™„ë£Œ');
});
</script>
{% endblock %}
